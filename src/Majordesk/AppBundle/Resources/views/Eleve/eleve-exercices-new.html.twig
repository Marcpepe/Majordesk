{% extends "MajordeskAppBundle:Eleve:navigation.html.twig" %}

{% block title %}
	Exercice en cours - {{ parent() }}
{% endblock %}

{% block navbar %}
	{% if is_granted("ROLE_ELEVE") and not is_granted("ROLE_PROF") %}
		{% if app.session.get('etape_cours') is not empty and app.session.get('etape_cours') == 1 %}
			<li><a href="{{ path('majordesk_app_verification_devoirs') }}"><i class="icon-angle-right"></i> Vérification des devoirs</a></li>
			<li><a><i class="icon-angle-right"></i> Exercice en cours</a></li>
		{% else %}
			<li><a href="{{ path('majordesk_app_chapitres') }}"><i class="icon-angle-right"></i> Liste des chapitres</a></li>
			<li><a href="{{ path('majordesk_app_parties', {'id_chapitre' : mod_exercice.chapitre.id}) }}"><i class="icon-angle-right"></i> Liste des exercices</a></li>
			<li><a><i class="icon-angle-right"></i> Exercice en cours</a></li>
		{% endif %}	
	{% elseif is_granted("ROLE_PROF") and not is_granted('ROLE_ADMIN') %}
		<li><a href="{{ path('majordesk_app_gestion_devoirs', {'id_eleve' : exercice.eleve.id }) }}"><i class="icon-angle-right"></i> Gestion des devoirs et exercices faits</a></li>
		<li><a><i class="icon-angle-right"></i> Exercice en cours</a></li>
	{% elseif is_granted('ROLE_ADMIN') %}
		<li><a href="{{ path('majordesk_app_gestion_contenu') }}"><i class="icon-angle-right"></i> Gestion du contenu</a></li>
		<li><a href="{{ path('majordesk_app_gestionnaire_exercices') }}"><i class="icon-angle-right"></i> Gestionnaire d'exercices</a></li>
		<li><a href="{{ path('majordesk_app_afficher_exercice', {'id' : exercice.modExercice.id }) }}"><i class="icon-angle-right"></i> Afficher un exercice</a></li>
		<li><a><i class="icon-angle-right"></i> Test de l'exercice</a></li>
	{% endif %}
{% endblock %}
{% block controlbar %}
	{{ parent() }}
	{% if is_granted("ROLE_ELEVE") and not is_granted("ROLE_PROF") and not is_granted("ROLE_PARENTS") and not is_granted("ROLE_ADMIN")  %}
	<li>
		<a>
			{% if app.session.get('etape_cours') == 2 %}<i id="control-delete" class="icon-remove icon-large control-btn cursor-help text-mid-grey" data-content="Voulez-vous retirer définitivement cet<br>exercice de la file d'attente ?<br><a class='btn btn-danger pull-right' href='{{ path('majordesk_app_ungenerate_exercice', {'id':exercice.id}) }}'>Supprimer</a>"></i>{% endif %}
			<i {% if app.session.get('etape_cours') != 1 %}id="control-lock"{% endif %} style="margin-left:12px" class="icon-large control-btn {% if app.session.get('etape_cours') != 1 %}cursor-help{% else %}cursor-forbidden{% endif %} {% if app.session.get('chapitre_only') != 0 or app.session.get('partie_only') != 0 %}icon-lock text-purple{% else %}icon-unlock-alt text-mid-grey{% endif %}" data-content="Dans ce chapitre uniquement {% if app.session.get('chapitre_only') != 0 %}<button class='btn btn-purple chapitre-unlock lock-unlock' data-loading-text='Désactivation...'><i class='icon-unlock-alt'></i> Désactiver</button> {% else %}<button class='btn btn-purple-inverted chapitre-lock lock-unlock' data-loading-text='Activation...'><i class='icon-lock'></i> Activer</button>{% endif %}<br><br>Dans cette partie uniquement {% if app.session.get('partie_only') != 0 %}<button class='btn btn-purple partie-unlock lock-unlock' data-loading-text='Désactivation...'><i class='icon-unlock-alt'></i> Désactiver</button> {% else %}<button class='btn btn-purple-inverted partie-lock lock-unlock' data-loading-text='Activation...'><i class='icon-lock'></i> Activer</button>{% endif %}"></i>
			<i {% if app.session.get('etape_cours') != 1 %}id="control-selection"{% endif %} style="margin-left:12px" class="icon-bullseye icon-large control-btn {% if app.session.get('etape_cours') != 1 %}cursor-help{% else %}cursor-forbidden{% endif %} {% if exercice.selection != 0 %}text-blue{% else %}text-mid-grey{% endif %}" data-content="{% if exercice.selection != 0 %}Cet exercice est à faire en devoir.{% else %}Cet exercice ne t'a été pas donné en devoir,<br>tu le fais pour t'entrainer.{% endif %}"></i> 
			<i {% if app.session.get('etape_cours') != 1 %}id="control-favoris"{% endif %} style="margin-left:10px" class="icon-star icon-large control-btn {% if app.session.get('etape_cours') != 1 %}cursor-help{% else %}cursor-forbidden{% endif %} {% if exercice.favoris == 1 %}text-yellow{% else %}text-mid-grey{% endif %}" data-content="{% if exercice.favoris == 1 %}Cet exercice a été mis de côté.<br><br>Tu pourras le revoir plus tard ou avec ton professeur,<br>en y accédant facilement depuis l'accueil.{% else %}<span class='hidden-xs'>Si tu as du mal avec cet exercice, tu peux<br> le mettre de côté et revenir dessus plus tard.<br><br></span>Veux-tu le mettre de côté ?<br><br><span class='pull-right'><button class='btn btn-warning to-favoris'><i class='icon-star'></i> Mettre de côté</button></span>{% endif %}"></i> 
			<i {% if app.session.get('etape_cours') != 1 %}id="control-navigation"{% endif %} data-id-matiere="{{ id_matiere }}" style="margin-left:10px" class="icon-fast-forward control-btn text-mid-grey {% if app.session.get('etape_cours') != 1 %}cursor-help{% else %}cursor-forbidden{% endif %}" data-content="{% if app.session.get('etape_cours') is not empty %}<a href='{{ path('majordesk_app_recherche_exercices', {'id_matiere' : id_matiere }) }}' class='btn btn-default'><i class='icon-forward'></i> Changer d'exercice</a>{% else %}<a href='{{ path('majordesk_app_chapitre_selection_queue', {'id_matiere':id_matiere}) }}' class='btn btn-default'><i class='icon-book'></i> Changer de chapitre</a><br><br><a {% if exercice.favoris == 1 or exercice.statut == statut_resolu %}href='{{ path('majordesk_app_exercice_next_in_queue', {'id_matiere':id_matiere}) }}'{% endif %} class='btn btn-default{% if exercice.favoris != 1 and exercice.statut != 2 %} to-favoris-before-next{% endif %}'><i class='icon-forward'></i> Passer à l'exercice suivant</a>{% endif %}"></i>
		</a>
	</li>
	{% endif %}
{% endblock %}

{% block eleve %}
	{% if is_granted("ROLE_ELEVE") %}
				<br><br><br><span class="visible-xs"><br></span>
				
				<div id="intro" data-id-matiere="{{ id_matiere }}"></div>
				
				<!-- slide out keyboard --> 
				<nav class="cbp-clavier cbp-clavier-vertical cbp-clavier-right" id="cbp-clavier">
					<section class="cbp-select">
						<div class="cbp-slide-left cbp-slide"><i class="icon-angle-left"></i></div>
						<div class="cbp-slide-right cbp-slide"><i class="icon-angle-right"></i></div>
					</section>
					<section class="cbp-quick-select">
						<div class="cbp-tile pull-left active" data-clavier-numero="1"></div>
						<div class="cbp-tile pull-left" data-clavier-numero="2"></div>
						<div class="cbp-tile pull-left" data-clavier-numero="3"></div>
						<div class="cbp-tile pull-left" data-clavier-numero="4"></div>
						<div class="cbp-tile pull-left" data-clavier-numero="5"></div>
					</section>
					<section class="cbp-children position-relative">
						<section class="cbp-child display-inline-block">
							<div class="cbp-inner-child">
								<div class="touche text-center height-60" style="font-size:28px;" latex="\mathbb{N}" left="0">$\mathbb{N}$</div>	
								<div class="touche text-center height-60" style="font-size:28px;" latex="\mathbb{Z}" left="0">$\mathbb{Z}$</div>	
								<div class="touche text-center height-60" style="font-size:28px;" latex="\mathbb{R}" left="0">$\mathbb{R}$</div>	
								<div class="touche text-center height-60" style="font-size:28px;" latex="\mathbb{R}^*" left="0">$\mathbb{R}^*$</div>	
								<div class="touche text-center height-60" style="font-size:28px;" latex="\mathbb{R}_+" left="0">$\mathbb{R}_+$</div>	
								<div class="touche text-center height-60" style="font-size:28px;" latex="\mathbb{R}_+^*" left="0">$\mathbb{R}_+^*$</div>	
								<div class="touche text-center height-60" style="font-size:28px;" latex="\mathbb{C}" left="0">$\mathbb{C}$</div>	
								<div class="touche text-center height-60" style="font-size:28px;" latex="\mathbb{Q}" left="0">$\mathbb{Q}$</div>
							</div>
						</section>
						<section class="cbp-child display-inline-block" data-clavier-numero="2">
							<div class="cbp-inner-child">
								<div class="touche text-center height-60" latex="+" left="0">$+$</div>
								<div class="touche text-center height-60" latex="-" left="0">$-$</div>
								<div class="touche text-center height-60" latex="\times" left="0">$\times$</div>
								<div class="touche text-center height-60" latex="\frac{}{}" left="2">$\div$</div>
								<div class="touche text-center height-60" latex="\sqrt{}" left="1">$\sqrt{a}$</div>
								<div class="touche text-center height-60" latex="^{}" left="1">$a^b$</div>
								<div class="touche text-center height-60" latex="_{}" left="1">$a_b$</div>
								<div class="touche text-center height-60" latex="=" left="0">$=$</div>
								<div class="touche text-center height-60" latex="> " left="0">$>$</div>
								<div class="touche text-center height-60" latex="\geq" left="0">$\geq$</div>
								<div class="touche text-center height-60" latex="< " left="0">$<$</div>
								<div class="touche text-center height-60" latex="\leq" left="0">$\leq$</div>
								<div class="touche text-center height-60" latex="\ne" left="0">$\ne$</div>
								<div class="touche text-center height-60" latex="\simeq" left="0">$\simeq$</div>
								<div class="touche text-center height-60" latex="\pm" left="0">$\pm$</div>
								<div class="touche text-center height-60" latex="\Rightarrow" left="0">$\Rightarrow$</div>
								<div class="touche text-center height-60" latex="\Leftrightarrow" left="0">$\Leftrightarrow$</div>
							</div>
						</section>
						<section class="cbp-child display-inline-block" data-clavier-numero="3">
							<div class="cbp-inner-child">
								<div class="touche text-center height-60" latex="\int_{}^{} f(x) \text{ }dx" left="9">$\int$</div>	
								<div class="touche text-center height-60" latex="\lim_{}{}" left="1">$\lim$</div>	
								<div class="touche text-center height-60" style="font-size:28px;" latex="\overline{}" left="1">$\overline{z}$</div>	
								<div class="touche text-center height-60" style="font-size:28px;" latex="\vec{}" left="1">$\vec{\text{AB}}$</div>
								<div class="touche text-center height-60" style="font-size:28px;" latex="\widehat{}" left="1">$\widehat{\text{ABC}}$</div>	
								<div class="touche text-center height-60" latex="\left(\right)" left="1">$\left(\text{...}\right)$</div>
								<div class="touche text-center height-60" latex="\left\{\right\}" left="1">$\left\{\text{...}\right\}$</div>
								<div class="touche text-center height-60" latex="\left[\right]" left="1">$\left[\text{...}\right]$</div>
								<div class="touche text-center height-60" latex="\left|\right|" left="1">$\left|\text{...}\right|$</div>
								<div class="touche text-center height-60" latex="\left||\right||" left="2">$\left||\text{...}\right||$</div>
								<div class="touche text-center height-60" latex="[[" left="1">$\left[\text{...}\right[$</div>
								<div class="touche text-center height-60" latex="]]" left="1">$\left]\text{...}\right]$</div>
								<div class="touche text-center height-60" latex="][" left="1">$\left]\text{...}\right[$</div>
							</div>
						</section>
						<section class="cbp-child display-inline-block" data-clavier-numero="4">
							<div class="cbp-inner-child">	
								<div class="touche text-center height-60" latex="\pi" left="0">$\pi$</div>	
								<div class="touche text-center height-60" latex="\infty" left="0">$\infty$</div>
								<div class="touche text-center height-60" latex="\forall" left="0">$\forall$</div>
								<div class="touche text-center height-60" latex="\in" left="0">$\in$</div>	
								<div class="touche text-center height-60" latex="\notin" left="0">$\notin$</div>	
								<div class="touche text-center height-60" latex="\subset" left="0">$\subset$</div>	
								<div class="touche text-center height-60" latex="\cap" left="0">$\cap$</div>	
								<div class="touche text-center height-60" latex="\cup" left="0">$\cup$</div>	
								<div class="touche text-center height-60" latex="\rightarrow" left="0">$\rightarrow$</div>	
								<div class="touche text-center height-60" latex="\mapsto" left="0">$\mapsto$</div>	
								<div class="touche text-center height-60" latex="\circ" left="0">$\circ$</div>	
								<div class="touche text-center height-60" latex="\ldots" left="0">$\ldots$</div>	
								<div class="touche text-center height-60" latex="\cdots" left="0">$\cdots$</div>	
								<div class="touche text-center height-60" style="font-size:28px;" latex="\vdots" left="0">$\vdots$</div>
								<div class="touche text-center height-60" latex="\alpha" left="0">$\alpha$</div>
								<div class="touche text-center height-60" latex="\beta" left="0">$\beta$</div>
								<div class="touche text-center height-60" latex="\gamma" left="0">$\gamma$</div>
								<div class="touche text-center height-60" latex="\delta" left="0">$\delta$</div>
								<div class="touche text-center height-60" latex="\zeta" left="0">$\zeta$</div>
								<div class="touche text-center height-60" latex="\eta" left="0">$\eta$</div>
								<div class="touche text-center height-60" latex="\theta" left="0">$\theta$</div>
								<div class="touche text-center height-60" latex="\iota" left="0">$\iota$</div>
								<div class="touche text-center height-60" latex="\kappa" left="0">$\kappa$</div>
								<div class="touche text-center height-60" latex="\lambda" left="0">$\lambda$</div>
								<div class="touche text-center height-60" latex="\mu" left="0">$\mu$</div>
								<div class="touche text-center height-60" latex="\nu" left="0">$\nu$</div>
								<div class="touche text-center height-60" latex="\xi" left="0">$\xi$</div>
								<div class="touche text-center height-60" latex="\rho" left="0">$\rho$</div>
								<div class="touche text-center height-60" latex="\sigma" left="0">$\sigma$</div>
								<div class="touche text-center height-60" latex="\tau" left="0">$\tau$</div>
								<div class="touche text-center height-60" latex="\chi" left="0">$\chi$</div>
								<div class="touche text-center height-60" latex="\psi" left="0">$\psi$</div>
								<div class="touche text-center height-60" latex="\omega" left="0">$\omega$</div>
								<div class="touche text-center height-60" latex="\Gamma" left="0">$\Gamma$</div>
								<div class="touche text-center height-60" latex="\Delta" left="0">$\Delta$</div>
								<div class="touche text-center height-60" latex="\Theta" left="0">$\Theta$</div>
								<div class="touche text-center height-60" latex="\Lambda" left="0">$\Lambda$</div>
								<div class="touche text-center height-60" latex="\Xi" left="0">$\Xi$</div>
								<div class="touche text-center height-60" latex="\Pi" left="0">$\Pi$</div>
								<div class="touche text-center height-60" latex="\Sigma" left="0">$\Sigma$</div>
								<div class="touche text-center height-60" latex="\Phi" left="0">$\Phi$</div>
								<div class="touche text-center height-60" latex="\Psi" left="0">$\Psi$</div>
								<div class="touche text-center height-60" latex="\Omega" left="0">$\Omega$</div>
							</div>
						</section>
						<section class="cbp-child display-inline-block" data-clavier-numero="5">
							<div class="cbp-inner-child">	
								<div class="touche text-center height-60" latex="cos\left(\right)" left="1">$cos$</div>	
								<div class="touche text-center height-60" latex="sin\left(\right)" left="1">$sin$</div>	
								<div class="touche text-center height-60" latex="tan\left(\right)" left="1">$tan$</div>	
								<div class="touche text-center height-60" latex="ln\left(\right)" left="1">$ln$</div>	
								<div class="touche text-center height-60" latex="log\left(\right)" left="1">$log$</div>	
								<div class="touche text-center height-60" latex="arg\left(\right)" left="1">$arg$</div>	
								<div class="touche text-center height-60" latex="\Re\left(\right)" left="1">$\Re$</div>	
								<div class="touche text-center height-60" latex="\Im\left(\right)" left="1">$\Im$</div>	
								<div class="touche text-center height-60" latex="\text{ }" left="1">$txt$</div>
							</div>
						</section>
					</section>
				</nav>
				
				<!-- new feedback --> 
				<div id="new-feedback" data-backdrop="static" data-keyboard="false" class="modal fade">
				  <div class="modal-dialog">
					<div class="modal-content">
					  <div class="modal-header">
						<button type="button" class="close cancel-case" data-dismiss="modal" aria-hidden="true">&times;</button>
						<h4 class="modal-title"><i class="icon-flag icon-large text-red"></i> Signaler un problème</h4>
					  </div>
					  <div class="modal-body">
						<p>
							<select name="feedback-type" class="form-control">
								<option value="1">Problème d'affichage</option>
								<option value="2">Erreur dans l'énoncé</option>
								<option value="3">Faute d'orthographe</option>
								<option value="4">Correction pas assez claire</option>
								<option value="5">Une question ne valide pas</option>
								<option value="6">Indice inutile</option>
								<option value="7">Bug</option>
							</select>
							<br>
							Si possible, précisez le problème :<br><br>
							<textarea name="feedback-commentaire" class="form-control"></textarea>
						</p>
					  </div>
					  <div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal"><i class="icon-left-angle"></i> Annuler</button>
						<button type="button" class="btn btn-danger send-feedback" data-loading-text="Envoi..." data-id-exercice="{{ mod_exercice.id }}"> Envoyer</button>
					  </div>
					</div>
				  </div>
				</div>
				
				<div class="hidden-xs">	
					<div class="col-sm-1 col-md-1 col-lg-1">
						<br><i id="clock" class="icon-time icon-large cursor-help" rel="tooltip" data-placement="bottom" data-animation="false" data-title="{{ exercice.temps|date('H:i:s') }}" ></i>
					</div>
					<div class="col-sm-11 col-md-11 col-lg-11">		
						<h4>Exercice (Id : {{ mod_exercice.id }})</h4>	
						{% if is_granted('ROLE_ADMIN') %}
						<span class="pull-right">
							<a href="{{ path('majordesk_app_reinit_test_exercice', {'id_exercice' : exercice.id}) }}" class="btn btn-warning">Réinit <i class="icon-refresh"></i></a>
						</span>
						{% endif %}
					</div>
				</div>
				<div class="clearfix"></div>
				<br>
				
				<!--QUESTION-->
				{% for mod_question in mod_questions %}
				{% set question = exercice.selectQuestionByNumero(mod_question.numero) %}
				{% set couche_max = mod_question.getNbCouches() %}
				{% set numero_reponse = 0 %}
					<div class="superbrique">	
						{% if mod_question.type == 'question' %}
						<div class="col-xs-12 col-lg-1">
							{% if question.statut == statut_resolu %}
								<i class="icon-ok text-success cursor-help" rel="tooltip" data-title="Terminé"></i> 
							{% elseif question.statut == statut_non_resolu or question.nombreEssais > 0 %}
								<i class="icon-remove text-red cursor-help" rel="tooltip" data-title="En cours..."></i>
							{% else %}
								<i class="icon-remove text-light-grey cursor-help" rel="tooltip" data-title="Non commencé"></i>
							{% endif %}
							<span class="badge cursor-help" rel="tooltip" data-title="Nombre d'essai(s)">{{ question.nombreEssais }}</span>
							<span class="visible-xs"><br></span>
							{#{% if is_granted("ROLE_PROF") %}
								<br><br>
								Réponse :<br>
								<button class="btn btn-default btn-xs" type="button" rel="tooltip" data-title="Réponse précédente (à venir)"><i class="icon-double-angle-left"></i></button>
								 {{ question.nombreEssais }} 
								<button class="btn btn-default btn-xs" type="button" rel="tooltip" data-title="Réponse suivante (à venir)"><i class="icon-double-angle-right"></i></button>
							{% endif %}#}
						</div>
						<div class="question-body col-xs-12 col-lg-6">
							<form method="post" action="#">
						{% elseif mod_question.type == 'entete' %}
						<div class="col-md-offset-1 col-lg-6">
						{% elseif mod_question.type == 'tutocours' %}
						<div class="col-md-offset-1 col-lg-11">
							<div class="alert alert-info">
								<i class="icon icon-info-sign"></i> <strong>Cours : </strong><br><br>
						{% endif %}
						
							<!--Enoncé-->
						{% for brique in mod_briques if brique.modQuestion.id == mod_question.id %}
						{% if lastCouche is defined and lastCouche != 0 and brique.couche != lastCouche %}</div>{% endif %}
						{% if brique.couche < couche_max and brique.couche != 0 and brique.couche != lastCouche %}<div class="alert alert-light-grey {% if question.couche != brique.couche and brique.couche != 0 %}hide{% endif %}"><span style="color:#d2d2d2;"><i class="icon-lightbulb"></i> <strong>Piste de réflexion :</strong></span><br>{% endif %}
						{% set lastCouche = brique.couche %}
						<span data-couche="{{ lastCouche }}" data-couche-max="{{ couche_max }}" {#{% if question.couche != lastCouche and lastCouche != 0 %}class="hide"{% endif %}#} >
							{% if brique.type == 'textnmaths' and brique.contenu is not null %}
								{{ brique.contenu|raw }}
							{% elseif brique.type == 'retour_ligne' %}
								<br>
							{% elseif brique.type == 'saut_ligne' %}
								<br><br>
							{% elseif brique.type == 'figure' or brique.type == 'graphique' %}
								<div id="{{ element.clavier }}" ></div>
							{% elseif brique.type == 'case' %}
								{% set numero_reponse = numero_reponse + 1 %}
								{% set reponse = question.selectLastMicroRep(numero_reponse) %}
								<div class="mathquill-editable input-eleve" data-numero-reponse="{{ numero_reponse }}" data-clavier="{{ brique.clavier }}">{% if reponse is not null %}{{ reponse.contenu|raw }}{% endif %}</div>
							{% elseif brique.type == 'case maths' %}
								<span class="mathquill-embedded-latex">{{ brique.contenu }}</span>
							{% elseif brique.type == 'equations' %}	
								<br>
								$\begin{eqnarray*}
								{% for equation in brique.contenu|json_decode|equationize %}
									{% if not loop.first %} \\ {% endif %}
										{{ equation.contenu }}
								{% endfor %}
								\end{eqnarray*}$
								<br>
							{% elseif brique.type == 'systeme' %}	
								<br>
								$\begin{cases}
								{% for equation in brique.contenu|json_decode %}
									{% if not loop.first %} \\ {% endif %}
										{{ equation.contenu }}
								{% endfor %}
								\end{cases}$
								<br>
							{% elseif brique.type == 'liste' %}	
								<br>
								{% for liste in brique.contenu|json_decode %}
									<ul>
										<li>{{ liste.contenu }}</li>
									</ul>
								{% endfor %}
								<br>
							{% elseif brique.type == 'liste ordonnee' %}	
								<br>
								{% for liste in brique.contenu|json_decode %}
									<ul>
										<li>{{ liste.contenu }}</li>
									</ul>
								{% endfor %}
								<br>
							{% elseif brique.type == 'liste deroulante' %}
								{% set numero_reponse = numero_reponse + 1 %}
								{% set reponse = question.selectLastMicroRep(numero_reponse) %}
									<select class="input-eleve form-special" data-numero-reponse="{{ numero_reponse }}">
										<option value=""> </option>
									{% for liste in brique.contenu|json_decode %}
										<option value="{{ loop.index }}" {% if reponse is not null and reponse.contenu == loop.index %}selected="selected"{% endif %}>{{ liste.contenu }}</option>
									{% endfor %}
									</select>							
							{% elseif brique.type == 'radio' %}	 
								{% set radio_numero = 1 %}
								{% set numero_reponse = numero_reponse + 1 %}
								{% set reponse = question.selectLastMicroRep(numero_reponse) %}
								<br>
								{% for radio in brique.contenu|json_decode %}
									<div class="radio">
										<label>
											<input class="input-eleve" type="radio" data-numero-reponse="{{ numero_reponse }}" data-radio-numero="{{ radio_numero }}" {% if reponse is not null and reponse.contenu == radio_numero %}checked="checked"{% endif %} name="radio-{{ brique.id }}" />
											 {{ radio.contenu }}
										</label>
									</div>
									{% set radio_numero = radio_numero + 1 %}
								{% endfor %}
								<br>
							{% elseif brique.type == 'checkbox' %}
								<br>
								{% for checkbox in brique.contenu|json_decode %}
								{% set numero_reponse = numero_reponse + 1 %}
								{% set reponse = question.selectLastMicroRep(numero_reponse) %}
									<div class="checkbox">
										<label>
											<input class="input-eleve" type="checkbox" data-numero-reponse="{{ numero_reponse }}" {% if reponse is not null and reponse.contenu == 1 %}checked="checked"{% endif %} />
											{{ checkbox.contenu }}
										</label>
									</div>
								{% endfor %}
								<br>
							{% elseif brique.type == 'vignettes' %}
								{% set numero_shift  = numero_reponse %}
								<br><br>
								{% if question.reponses|length > 0 %}
									{% set briques = brique.contenu|json_decode %}
									{% for i in 1..briques|length %}
									{% set numero_reponse = numero_reponse + 1 %}
									{% set reponse = question.selectLastMicroRep(numero_reponse) %}	
										<div class="well cursor-move input-eleve" data-numero-shift="{{ numero_shift }}" data-numero-vignette="{{ reponse.contenu }}">
											{% if reponse is not empty %}{{ briques[reponse.contenu].contenu|raw }}{% endif %}
										</div>
									{% endfor %}
								{% else %}
									{% for vignette in brique.contenu|json_decode|shuffle %}
									{% set numero_reponse = numero_reponse + 1 %}
										<div class="well cursor-move input-eleve" data-numero-shift="{{ numero_shift }}" data-numero-vignette="{{ loop.index }}">
											{{ vignette.contenu|raw }}
										</div>
									{% endfor %}
								{% endif %}
								<br>
							{% elseif brique.type == 'tableau' %}
								<div class="table-responsive">
									<table class="table table-bordered">
										<tbody>
											{% for row in brique.contenu|json_decode %}
											<tr>
												{% for cell in row %}
												<td>
													{% if cell.input == 1 %}
														{% set numero_reponse = numero_reponse + 1 %}
														{% set reponse = question.selectLastMicroRep(numero_reponse) %}
														<div class=" text-center"><div class="mathquill-editable input-eleve" data-numero-reponse="{{ numero_reponse }}" data-clavier="{{ brique.clavier }}">{% if reponse is not null %}{{ reponse.contenu|raw }}{% endif %}</div></div>
													{% else %}
														<div class=" text-center">{{ cell.contenu }}</div>
													{% endif %}
												</td>
												{% endfor %}
											</tr>
											{% endfor %}
										</tbody>
									</table>
								</div>
							{% elseif brique.type == 'tableau analyse' %}
								{% if '"input":"1"' in brique.contenu %}
									{% set numero_reponse = numero_reponse + 1 %}
									{% set reponse = question.selectLastMicroRep(numero_reponse) %}
									{% if reponse is not empty %}
										{% set repTab = reponse.contenu|json_decode %}
										{% set isInit = false %}
									{% else %}
										{% set repTab = brique.contenu|json_decode|initialize_tableau %}
										{% set isInit = true %}
									{% endif %}
								{% else %}
									{% set repTab = brique.contenu|json_decode %}
									{% set isInit = true %}
								{% endif %}
								<div class="table-responsive">
									<table data-contenu="{{ repTab|json_encode }}" class="table table-borderless tableau-analyse {% if '"input":"1"' in brique.contenu %}input-eleve"  data-numero-reponse="{{ numero_reponse }}"{% else %}"{% endif %}>
										<tbody>
											{% for row_key, row in repTab %}
											<tr {% if not loop.last %}style="border-bottom:1px solid black"{% endif %} data-cell-row="{{ row_key }}">
												{% if row.type == 'entete' %}
													{% for cell_key, cell in row.contenu %}
													<td data-cell-col="{{ cell_key }}" {% if loop.first %}class="col-lg-2" style="border-right:1px solid black;"{% endif %}>
														<div class="text-center">{% if cell.input and loop.index%2==0 %} <span class="mathquill-editable cell-analyse cell-analyse-input-normal" data-clavier="2">{% if not isInit %}{{ cell.contenu }}{% endif %}</span> {% else %}{% if cell.contenu is not empty %}${{ cell.contenu }}${% endif %} {% endif %}</div>
													</td>
													{% endfor %}
												{% elseif row.type == 'signe' %}
													{% for cell_key, cell in row.contenu %}
														{% if cell.input and isInit %}
															{% if loop.index % 2 == 0 %}
																<td data-cell-col="{{ cell_key }}" class="cursor cell-analyse-signes-entresigne"></td>
															{% else %}
																<td data-cell-col="{{ cell_key }}" class="cursor cell-analyse-signes-signe">
																	<div class="text-center">$+$</div>
																</td>
															{% endif %}
														{% else %}
															{% if cell.contenu == '%valeur-nulle%' %}
																<td data-cell-col="{{ cell_key }}" {% if cell.input and not isInit %}class="cursor cell-analyse-signes-entresigne"{% endif %} style="height:100%;background-image: url('../img/maths/valeur-nulle.png');background-repeat:repeat-y;background-position:center;vertical-align-center">
																	<div class="text-center">$0$</div>
																</td>
															{% elseif cell.contenu == '%valeur-interdite%' %}
																<td data-cell-col="{{ cell_key }}" {% if cell.input and not isInit %}class="cursor cell-analyse-signes-entresigne"{% endif %} style="height:100%;background-image: url('../img/maths/valeur-interdite.png');background-repeat:repeat-y;background-position:center;vertical-align-center">
																	<div class="text-center"></div>
																</td>
															{% else %}
																<td data-cell-col="{{ cell_key }}" {% if loop.first %}class="col-lg-2" style="border-right:1px solid black;"{% else %}{% if cell.input and not isInit %}{% if cell.contenu is not empty %}class="cursor cell-analyse-signes-signe"{% else %}class="cursor cell-analyse-signes-entresigne"{% endif %}{% endif %}{% endif %}>
																	<div class="text-center">{% if cell.contenu is not empty %}${{ cell.contenu }}${% endif %}</div>
																</td>
															{% endif %}
														{% endif %}
													{% endfor %}
												{% elseif row.type == 'variations' %}
													{% set flecheType = row.contenu|length / 2 - 1 %}
													{% for cell_key, cell in row.contenu %}
														{% if cell.input and isInit %}
															{% if loop.index == 2 %}
																<td data-cell-col="{{ cell_key }}" class="cursor cell-analyse cell-analyse-variations-borneg"></td>
															{% elseif loop.last %}
																<td data-cell-col="{{ cell_key }}" class="cursor cell-analyse cell-analyse-variations-borned"></td>
															{% elseif loop.index % 2 == 0 %}
																<td data-cell-col="{{ cell_key }}" class="cursor cell-analyse cell-analyse-variations-borne"></td>
															{% else %}
																<td data-cell-col="{{ cell_key }}" class="cursor cell-analyse-variations-fleche" style="padding-left:0;padding-right:0;">
																{% if flecheType == 1 %}<div class="text-center"><img src="{{ asset('img/maths/asc-1.png') }}"/></div>
																{% elseif cell.position == 'haut' %}<div class="text-center"><img src="{{ asset('img/maths/asc-haut-' ~ flecheType ~ '.png') }}"/></div>
																{% elseif cell.position == 'milieu' %}<div class="text-center"><img src="{{ asset('img/maths/asc-milieu-' ~ flecheType ~ '.png') }}"/></div>
																{% elseif cell.position == 'bas' %}<div class="text-center"><img src="{{ asset('img/maths/asc-bas-' ~ flecheType ~ '.png') }}"/></div>
																{% endif %}
																</td>
															{% endif %}
														{% else %}
															{% if cell.contenu == '%vide%' %}
																<td data-cell-col="{{ cell_key }}" {% if cell.input and not isInit %}class="cursor cell-analyse-variations-{% if loop.index == 2 %}borneg{% elseif loop.last %}borned{% elseif loop.index % 2 == 0 %}borne{% endif %}"{% endif %} style="padding-left:0;padding-right:0;">
																</td>
															{% elseif cell.contenu == '%asc%' %}
																<td data-cell-col="{{ cell_key }}" {% if cell.input and not isInit %}class="cursor cell-analyse-variations-fleche"{% endif %} style="padding-left:0;padding-right:0;">
																{% if flecheType == 1 %}<div class="text-center"><img src="{{ asset('img/maths/asc-1.png') }}"/></div>
																{% elseif cell.position == 'haut' %}<div class="text-center"><img src="{{ asset('img/maths/asc-haut-' ~ flecheType ~ '.png') }}"/></div>
																{% elseif cell.position == 'milieu' %}<div class="text-center"><img src="{{ asset('img/maths/asc-milieu-' ~ flecheType ~ '.png') }}"/></div>
																{% elseif cell.position == 'bas' %}<div class="text-center"><img src="{{ asset('img/maths/asc-bas-' ~ flecheType ~ '.png') }}"/></div>
																{% endif %}
																</td>
															{% elseif cell.contenu == '%desc%' %}
																<td data-cell-col="{{ cell_key }}" {% if cell.input and not isInit %}class="cursor cell-analyse-variations-fleche"{% endif %} style="padding-left:0;padding-right:0;">
																{% if flecheType == 1 %}<div class="text-center"><img src="{{ asset('img/maths/desc-1.png') }}"/></div>
																{% elseif cell.position == 'haut' %}<div class="text-center"><img src="{{ asset('img/maths/desc-haut-' ~ flecheType ~ '.png') }}"/></div>
																{% elseif cell.position == 'milieu' %}<div class="text-center"><img src="{{ asset('img/maths/desc-milieu-' ~ flecheType ~ '.png') }}"/></div>
																{% elseif cell.position == 'bas' %}<div class="text-center"><img src="{{ asset('img/maths/desc-bas-' ~ flecheType ~ '.png') }}"/></div>
																{% endif %}
																</td>
															{% elseif cell.contenu == '%valeur-interdite%' %}
																<td data-cell-col="{{ cell_key }}" {% if cell.input and not isInit %}class="cursor cell-analyse-variations-borne"{% endif %} style="padding:0;height:100%;background-image: url('../img/maths/valeur-interdite.png');background-repeat:repeat-y;background-position:center;font-size:10px;">
																	<div class="text-center">
																		<div class="display-inline-block" style="width:22px;{% if cell.positiong == 'bas' %}position:relative;{% if flecheType == 1 %}80px{% elseif flecheType == 2 %}top:80px{% elseif flecheType == 3 %}top:60px{% elseif flecheType == 4 %}top:40px{% endif %}{% endif %}">{% if cell.input and not isInit %}<span class="mathquill-editable mathquill-update cell-analyse cell-analyse-input-borneg">{{ cell.borneg }}</span>{% else %}{% if cell.borneg is not empty %}${{ cell.borneg }}${% endif %}{% endif %}</div><div class="display-inline-block" style="width:5px;"></div><div class="display-inline-block" style="width:22px;{% if cell.positiond == 'bas' %}position:relative;{% if flecheType == 1 %}80px{% elseif flecheType == 2 %}top:80px{% elseif flecheType == 3 %}top:60px{% elseif flecheType == 4 %}top:40px{% endif %}{% endif %}">{% if cell.input and not isInit %}<span class="mathquill-editable mathquill-update cell-analyse cell-analyse-input-borned">{{ cell.borned }}</span>{% else %}{% if cell.borned is not empty %}${{ cell.borned }}${% endif %}{% endif %}</div>
																	</div>
																</td>
															{% elseif cell.contenu == '%bg-interdite%' %}
																<td data-cell-col="{{ cell_key }}" {% if cell.input and not isInit %}class="cursor cell-analyse-variations-borneg"{% endif %} style="padding:0;height:100%;background-image: url('../img/maths/valeur-interdite.png');background-repeat:repeat-y;background-position:left;{% if flecheType > 2 %}font-size:10px;{% endif %}">
																	<div class="text-center" 
																	{% if cell.position == 'bas' %}
																		style="position:relative;{% if flecheType == 1 %}80px{% elseif flecheType == 2 %}top:80px{% elseif flecheType == 3 %}top:60px{% elseif flecheType == 4 %}top:40px{% endif %}"
																	{% endif %}
																	>
																		<div class="display-inline-block" style="width:12px;"></div><div class="display-inline-block" style="width:22px;">{% if cell.input and not isInit %}<span class="mathquill-editable mathquill-update cell-analyse cell-analyse-input-borned">{{ cell.borned }}</span>{% else %}{% if cell.borned is not empty %}${{ cell.borned }}${% endif %}{% endif %}</div>
																	</div>
																</td>
															{% elseif cell.contenu == '%bd-interdite%' %}
																<td data-cell-col="{{ cell_key }}" {% if cell.input and not isInit %}class="cursor cell-analyse-variations-borned"{% endif %} style="padding:0;height:100%;background-image: url('../img/maths/valeur-interdite.png');background-repeat:repeat-y;background-position:right;{% if flecheType > 2 %}font-size:10px;{% endif %}">
																	<div class="text-center" 
																	{% if cell.position == 'bas' %}
																		style="position:relative;{% if flecheType == 1 %}80px{% elseif flecheType == 2 %}top:80px{% elseif flecheType == 3 %}top:60px{% elseif flecheType == 4 %}top:40px{% endif %}"
																	{% endif %}
																	>
																		<div class="display-inline-block" style="width:22px;">{% if cell.input and not isInit %}<span class="mathquill-editable mathquill-update cell-analyse cell-analyse-input-borneg">{{ cell.borneg }}</span>{% else %}{% if cell.borneg is not empty %}${{ cell.borneg }}${% endif %}{% endif %}</div><div class="display-inline-block" style="width:8px;"></div>
																	</div>
																</td>
															{% else %}
																<td data-cell-col="{{ cell_key }}" {% if loop.first %}class="col-lg-2" style="border-right:1px solid black"{% else %} {% if cell.input and not isInit %}class="cursor cell-analyse-variations-{% if loop.index == 2 %}borneg{% elseif loop.last %}borned{% elseif loop.index % 2 == 0 %}borne{% endif %}"{% endif %}{% endif %}>
																	<div class="text-center"
																	{% if cell.position == 'milieu' %}
																		style="position:relative;{% if flecheType == 1 %}40px{% elseif flecheType == 2 %}top:40px{% elseif flecheType == 3 %}top:30px{% elseif flecheType == 4 %}top:20px{% endif %}"
																	{% elseif cell.position == 'bas' %}
																		style="position:relative;{% if flecheType == 1 %}80px{% elseif flecheType == 2 %}top:80px{% elseif flecheType == 3 %}top:60px{% elseif flecheType == 4 %}top:40px{% endif %}"
																	{% endif %}
																	>{% if cell.input and not isInit %}<span class="mathquill-editable mathquill-update cell-analyse cell-analyse-input-normal">{{ cell.contenu }}</span>{% else %}{% if cell.contenu is not empty %}${{ cell.contenu }}${% endif %}{% endif %}</div>
																</td>
															{% endif %}
														{% endif %}
													{% endfor %}
												{% endif %}
											</tr>
											{% endfor %}
										</tbody>
									</table>
								</div>
							{% endif %}
						</span>
						{% endfor %}
						<!---------->
						
					{% if mod_question.type == 'question' %}	
							{% if (is_granted("ROLE_ELEVE") and not is_granted("ROLE_PROF")) or is_granted('ROLE_ADMIN') %}
								{% if question.statut != statut_resolu %}<span><br><button class="btn btn-success pull-right valider" type="button" data-loading-text="Validation..." data-id-exercice="{{ exercice.id }}" data-id-question="{{ question.id }}" >Valider <i class="icon-ok text-white"></i></button></span>{% endif %}
							{% endif %}
							</form>
						</div>
						<div class="visible-xs visible-sm clearfix"><br><br></div>
						<div class="col-xs-12 col-lg-5 commentaire">
							<!--Correction-->	
							{{ question.getLatestCommentaire|raw }}
							<!-------------->
						</div>
					{% elseif mod_question.type == 'entete' %}
						<br><br>
						</div><div class="col-lg-5"></div><div class="clearfix"></div>
					{% elseif mod_question.type == 'tutocours' %}
						</div>
						</div>
					{% endif %}	
					</div>
					<div class="clearfix"></div>
				{% endfor %}
	{% endif %}
{% endblock %}

{% block footer %}
	<small>Signaler un problème sur cet exercice : <button class="btn btn-xs btn-default" data-toggle="modal" data-target="#new-feedback"><i class="icon-flag"></i></button></small>
{% endblock %}

{% block javascripts %}
	{{ parent() }}
	{% javascripts filter='yui_js' output='js/*'
		'../app/Resources/js/common/mathquill.js' 
		'../app/Resources/js/eleve/eleve-exercices-new.js'
		'../app/Resources/js/common/clavier-slide-out.js' 
	%}
		<script type="text/javascript" src="{{ asset_url }}"></script>
	{% endjavascripts %}
{% endblock %}




